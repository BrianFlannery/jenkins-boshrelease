
set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables


set -x # verbose display of each command


export PACKAGE_NAME=$(basename $BOSH_COMPILE_TARGET)


# Available variables:
# $BOSH_INSTALL_TARGET - /var/vcap/packages/$PACKAGE_NAME
# $BOSH_COMPILE_TARGET - /var/vcap/data/compile/$PACKAGE_NAME
# $PWD - $BOSH_COMPILE_TARGET

# don't use the apt-get install approach as there are tons of problems if foncconfig .deb package is not installed in the standard folders (Cyrille Le Clerc)


# install freetype
tar -xf $PACKAGE_NAME/freetype-2.5.3.tar.bz2
cd freetype-2.5.3

sed -i  -e "/AUX.*.gxvalid/s@^# @@" -e "/AUX.*.otvalid/s@^# @@" modules.cfg
sed -ri -e 's:.*(#.*SUBPIXEL.*) .*:\1:' include/config/ftoption.h

./configure --prefix=$BOSH_INSTALL_TARGET
make
make prefix=$BOSH_INSTALL_TARGET/freetype install

cd ..

# install fontconfig
tar -xf $PACKAGE_NAME/fontconfig-2.11.1.tar.bz2
cd fontconfig-2.11.1

export PKG_CONFIG_PATH=$BOSH_INSTALL_TARGET/freetype/lib/pkgconfig
export CPPFLAGS="-I/var/vcap/packages/fontconfig/freetype/include -I/var/vcap/packages/fontconfig/freetype/include/freetype2"
export LDFLAGS="-L/var/vcap/packages/fontconfig/freetype/lib"
./configure --prefix=$BOSH_INSTALL_TARGET --disable-docs --enable-libxml2
make
make prefix=$BOSH_INSTALL_TARGET install

